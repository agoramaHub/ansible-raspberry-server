- name: Authentication setup
  hosts: localhost
  gather_facts: no

  vars_prompt:
    - name: 'ssh_public_key_path'
      prompt: 'Where is your SSH public key?'
      default: '~/.ssh/id_rsa.pub'
      private: no
    - name: 'user_password'
      prompt: 'What should the user password be?'
      private: yes
      encrypt: 'sha512_crypt'
      confirm: yes
      salt: 'raspberry'

  tasks:
    - name: 'Save authentication variables'
      copy:
        dest: './vars/auth.yml'
        content: |
          # This file was generated by the auth.yml playbook.
          # Don't try to edit it by hand, run `ansible-playbook auth.yml` instead.

          {{ {"ssh_public_key_path": ssh_public_key_path, "user_password": user_password} | to_nice_yaml }}
